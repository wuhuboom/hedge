<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>用户列表</title>
    <link rel="stylesheet" href="../../assets/libs/layui/css/layui.css"/>
    <link rel="stylesheet" href="../../assets/module/admin.css?v=318"/>
    <script src="../../assets/js/moment.js"></script>

    <style>

        .currSerachBtn {
            box-shadow: 0 15px 18px -6px rgb(45 140 240 / 65%) !important;
        }

        .currReloadBtn {
            box-shadow: 0 15px 18px -6px rgb(146 109 222 / 65%) !important;
        }

        .layui-table-cell {
            height: 46px;
            line-height: 46px;

            /*height: auto ;*/
            /*white-space: normal;*/
            /*word-wrap:break-word;*/
        }


    </style>


    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<!-- 正文开始 -->
<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-card-body">

            <!-- 表格工具栏 -->
            <form class="layui-form toolbar">
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">商户号:</label>
                        <div class="layui-input-inline">
                            <input name="merchant_num" id="merchant_num" class="layui-input" placeholder="请输入商户号"/>
                        </div>
                    </div>

                    <div class="layui-inline">
                        <label class="layui-form-label">商户订单号:</label>
                        <div class="layui-input-inline">
                            <input name="merchant_order_num" id="merchant_order_num" class="layui-input" placeholder="请输入商户订单号"/>
                        </div>
                    </div>


                    <div class="layui-inline">
                        <label class="layui-form-label">平台订单号:</label>
                        <div class="layui-input-inline">
                            <input name="own_order" id="own_order" class="layui-input" placeholder="请输入平台订单号"/>
                        </div>
                    </div>

                    <div class="layui-inline">
                        <label class="layui-form-label">支付凭证:</label>
                        <div class="layui-input-inline">
                            <input name="proof_of_payment" id="proof_of_payment" class="layui-input" placeholder="请输入支付凭证"/>
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">Upi:</label>
                        <div class="layui-input-inline">
                            <input name="upi" id="upi" class="layui-input" placeholder="请输入upi"/>
                        </div>
                    </div>

                    <div class="layui-inline">
                        <label class="layui-form-label">分类:</label>
                        <div class="layui-input-inline">
                            <select name="species" id="species">
                                <option value="">所有</option>
                                <option value="1">三方单子</option>
                                <option value="2">对冲</option>
                                <option value="3">跑单</option>
                            </select>
                        </div>
                    </div>

                    <div class="layui-inline">
                        <label class="layui-form-label">状态:</label>
                        <div class="layui-input-inline">
                            <select name="status" id="status">
                                <option value="999">所有</option>
                                <option value="1">等待支付</option>
                                <option value="2">支付成功</option>
                                <option value="3">失败</option>
                                <option value="4">已过期</option>
                                <option value="5">已确认</option>
                                <option value="7">冲正</option>
                            </select>
                        </div>
                    </div>

                    <div class="layui-inline">
                        <label class="layui-form-label">回调状态:</label>
                        <div class="layui-input-inline">
                            <select name="callback" id="callback">
                                <option value="777">所有</option>
                                <option value="1">没有回调</option>
                                <option value="2">回调成功</option>
                                <option value="3">回调失败</option>
                            </select>
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">开始日期</label>
                        <div class="layui-input-inline">
                            <input type="text" class="layui-input" id="startDate" name="startDate"
                                   placeholder="yyyy-MM-dd HH:mm:ss">
                        </div>
                    </div>


                    <div class="layui-inline">
                        <label class="layui-form-label">结束日期</label>
                        <div class="layui-input-inline">
                            <input type="text" class="layui-input" id="endDate" name="endDate"
                                   placeholder="yyyy-MM-dd HH:mm:ss">
                        </div>
                    </div>

                    <div class="layui-inline">
                        <label class="layui-form-label" >上传支付凭证:</label>
                        <div class="layui-input-inline">
                            <select name="proof_of_payment_image_url" id="proof_of_payment_image_url">
                                <option value="2">否</option>
                                <option value="1">是</option>
                            </select>
                        </div>
                    </div>


                    <div class="layui-inline">&emsp;
                        <!--                        <button class="layui-btn icon-btn currSerachBtn" lay-filter="addGropeTask" id="addGropeTask" lay-submit style="background-image: linear-gradient(to right, #fa709a 0%, #fee140 100%);">-->
                        <!--                            <i class="layui-icon">&#xe624;</i>添加-->
                        <!--                        </button>-->
                        <button class="layui-btn icon-btn currSerachBtn" lay-filter="userTbSearch" lay-submit>
                            <i class="layui-icon">&#xe615;</i>搜索
                        </button>
                        <button class="layui-btn icon-btn currReloadBtn" lay-filter="reloadData" lay-submit
                                style="background-color: #926dde;border-color: #926dde;">
                            <i class="layui-icon layui-icon-refresh"></i>刷新数据
                        </button>
                    </div>
                </div>
            </form>

            <!-- 数据表格 -->
            <table id="userTable" lay-filter="userTable" style="margin-top:10px"></table>
        </div>
    </div>
</div>


<!-- js部分 -->
<script type="text/javascript" src="../../assets/libs/layui/layui.js"></script>
<script type="text/javascript" src="../../assets/js/common.js?v=318"></script>

<script type="text/javascript" src="../../assets/js/jquery.min.js"></script>
<script type="text/javascript" src="../../assets/js/jquery.cookie.min.js"></script>
<script type="text/javascript" src="../../assets/js/config.url.js"></script>


<!--数据表格操作工具栏-->
<script type="text/html" id="orderListBar">
    <a class="layui-btn layui-btn-sm layui-btn-radius" lay-event="callbacksuccess" style="background-color: #ffba00"><i
            class="layui-icon layui-icon-ok"></i>回调成功</a>
    <a class="layui-btn layui-btn-sm layui-btn-radius " lay-event="detailBtn" style="background-color: #6891f9 "><i
            class="layui-icon layui-icon-transfer"></i>详情</a>
    {{#  if(d.Status == 1 || d.Status == 4 || d.Status == 5 || d.Status == 7){ }}
    <a class="layui-btn layui-btn-sm layui-btn-radius" lay-event="confirpay" style="background-color: #ee00ff"><i
            class="layui-icon layui-icon-windows"></i>审核</a>
    {{#  } else if(d.Status == 2 || d.Status == 3){ }}
    <a class="layui-btn layui-btn-sm layui-btn-radius " lay-event="redo" style="background-color: #f9687c "><i
            class="layui-icon layui-icon-fire"></i>冲正</a>
    {{#  } }}
</script>

<script>

    var mybck = $.cookie('tokenMyb');
    //alert(document.cookie);
    // console.log(mybck)
    if (mybck == "" || mybck == null) {

        window.top.location.href = "../../login.html";

    } else {

        var jsondata;
        var bankListArr = []

        var currDateVal
        var currDateVal_end
        var local_storage_key = 'admin_pay_order_list_t_list';
        layui.use(['layer', 'form', 'table', 'util', 'admin', 'xmSelect', 'notice', 'treeTable', 'laydate'], function () {
            var $ = layui.jquery;
            var layer = layui.layer;
            var form = layui.form;
            var table = layui.table;
            var util = layui.util;
            var admin = layui.admin;
            var xmSelect = layui.xmSelect;
            var notice = layui.notice;
            var treeTable = layui.treeTable
            var laydate = layui.laydate;

            //开始日期组件常规用法
            laydate.render({
                elem: '#startDate'
                , isInitValue: true
                , theme: 'molv'
                , type: 'datetime'
                , done: function (value, date) {//选中后的回调
                    // layer.alert('你选择的日期是：' + value + '<br>获得的对象是' + JSON.stringify(date));
                    // console.log("自带的",date)
                    // console.log("jquery",$("#buildDate").val())
                    currDateVal = ""
                    currDateVal = value
                }
            });


            //结束日期组件常规用法
            laydate.render({
                elem: '#endDate'
                , isInitValue: true
                , theme: 'molv'
                , type: 'datetime'
                , done: function (value, date) {//选中后的回调
                    // layer.alert('你选择的日期是：' + value + '<br>获得的对象是' + JSON.stringify(date));
                    // console.log("自带的",date)
                    // console.log("jquery",$("#buildDate").val())
                    currDateVal_end = ""
                    currDateVal_end = value
                }
            });


            let loadU_startDate = localStorage.getItem('pay_order_where_startDate')
            let loadU_endDate = localStorage.getItem('pay_order_where_endDate')
            $("#startDate").val(loadU_startDate)
            $("#endDate").val(loadU_endDate)

            //分类--(可用)
            let loadU_species = localStorage.getItem('pay_order_where_species')
            $("#species").val(loadU_species)

            //商户号
            let loadU_merchant_num = localStorage.getItem('pay_order_where_merchant_num')
            $("#merchant_num").val(loadU_merchant_num)

            //商户订单号
            let loadU_merchant_order_num = localStorage.getItem('pay_order_where_merchant_order_num')
            $("#merchant_order_num").val(loadU_merchant_order_num)

            //平台订单号
            let loadU_own_order = localStorage.getItem('pay_order_where_own_order')
            $("#own_order").val(loadU_own_order)

            //支付凭证
            let loadU_proof_of_payment = localStorage.getItem('pay_order_where_proof_of_payment')
            $("#proof_of_payment").val(loadU_proof_of_payment)

            //Upi
            let loadU_upi = localStorage.getItem('pay_order_where_upi')
            $("#upi").val(loadU_upi)

            //状态
            let loadU_status = localStorage.getItem('pay_order_where_status')
            $("#status").val(loadU_status)

            //回调状态
            let loadU_callback = localStorage.getItem('pay_order_where_callback')
            $("#callback").val(loadU_callback)

            //重新渲染生效
            form.render();
            //
            var request_param = {};
            // request_param['kinds'] = 1;
            // log_login_request_param['token']= $.cookie('tokenMyb');
            // var currTempObj = {}
            request_param.kinds = 1
            // currTempObj.token = $.cookie('tokenMyb');

            //分类
            if (loadU_species){
                request_param.species = loadU_species
            }
            // localStorage.setItem('pay_order_where_species',data.field.species)

            //商户号
            if (loadU_merchant_num) {
                request_param.merchant_num = loadU_merchant_num
            }
            // localStorage.setItem('pay_order_where_merchant_num',data.field.merchant_num)

            //商户订单号
            if (loadU_merchant_order_num) {
                request_param.merchant_order_num = loadU_merchant_order_num
            }
            // localStorage.setItem('pay_order_where_merchant_order_num',data.field.merchant_order_num)

            //平台订单号
            if (loadU_own_order) {
                request_param.own_order = loadU_own_order
            }
            // localStorage.setItem('pay_order_where_own_order',data.field.own_order)

            //支付凭证
            if (loadU_proof_of_payment) {
                request_param.proof_of_payment = loadU_proof_of_payment
            }
            // localStorage.setItem('pay_order_where_proof_of_payment',data.field.proof_of_payment)

            //Upi
            if (loadU_upi){
                request_param.upi =loadU_upi
            }
            // localStorage.setItem('pay_order_where_upi',data.field.upi)

            //状态
            if (loadU_status === "999") {


            } else if (loadU_status != "999" && loadU_status){
                request_param.status = loadU_status
            }
            // localStorage.setItem('pay_order_where_status',data.field.status)

            //回调状态
            if (loadU_callback === "777") {

            } else if (loadU_callback != "777" && loadU_callback) {
                request_param.callback = loadU_callback
            }
            // localStorage.setItem('pay_order_where_callback',data.field.callback)

            var todayStartTime = new Date(new Date().toLocaleDateString()).getTime() / 1000 + 1
            var todayEndTime = new Date(new Date().toLocaleDateString()).getTime() / 1000 + 24 * 60 * 60 - 1

            if (loadU_startDate == '' && loadU_endDate == '') {

                // request_param.start = todayStartTime
                // request_param.end = todayEndTime

            } else if (loadU_startDate != '' && loadU_endDate != '') {

                var date_str_start = new Date(loadU_startDate)
                request_param.start = Date.parse(date_str_start) / 1000

                var date_str_end = new Date(loadU_endDate)
                request_param.end = Date.parse(date_str_end) / 1000

            } else {

                if (loadU_startDate == "" && loadU_endDate != "") {

                    request_param.start = 0
                    var date_str_end = new Date(loadU_endDate)
                    request_param.end = Date.parse(date_str_end) / 1000

                } else if (loadU_startDate != "" && loadU_endDate == "") {

                    var date_str_start = new Date(loadU_startDate)
                    request_param.start = Date.parse(date_str_start) / 1000
                    request_param.end = todayEndTime
                }


            }
            // localStorage.setItem('pay_order_where_startDate',data.field.startDate)
            // localStorage.setItem('pay_order_where_endDate',data.field.endDate)



            /* 渲染表格 */
            var tableCols = tableSetCol(getTableCols(), local_storage_key);
            var insTb = table.render({
                elem: '#userTable',
                url: global_requestAddress + global_requestAddress_js_collectionOperation + "?action=check",
                method: 'post',
                headers: {
                    token: mybck
                },
                response: {
                    statusCode: 200,
                    dataName: 'result',
                },
                toolbar: true,
                defaultToolbar: ['filter'],
                where: request_param,
                // toolbar: ['<p>',
                //     '<button lay-event="add" class="layui-btn layui-btn-sm icon-btn"><i class="layui-icon">&#xe654;</i>添加</button>&nbsp;',
                //     '<button lay-event="del" class="layui-btn layui-btn-sm layui-btn-danger icon-btn"><i class="layui-icon">&#xe640;</i>删除</button>',
                //     '</p>'].join(''),
                cellMinWidth: 100,
                page: { //支持传入 laypage 组件的所有参数（某些参数除外，如：jump/elem） - 详见文档
                    layout: ['limit', 'count', 'prev', 'page', 'next', 'skip'] //自定义分页布局
                    //,curr: 5 //设定初始在第 5 页
                    , groups: 10 //只显示 1 个连续页码
                    , first: "首页" //不显示首页
                    , last: "尾页"//不显示尾页
                },
                height: "full-150",
                limit: 20,
                limits: [20, 30, 50, 100],
                // id : "systemLog",
                cols: tableCols,
                done: function (res, curr, count) {
                    $('tr').css({'background-color': '#fff', 'color': '#191a1c'});

                    tableDone(this.elem, insTb.config.cols[0], local_storage_key)

                    //重新渲染 固定写法
                    form.render("select");
                    // $(".layui-table-main tr").each(function (index, val) {
                    //     $($(".layui-table-fixed-l .layui-table-body tbody tr")[index]).height($(val).height());
                    //     $($(".layui-table-fixed-r .layui-table-body tbody tr")[index]).height($(val).height());
                    // });

                }
            });


            //layui表格渲染后，事件需要重新绑定，并记录下筛选信息于localStorage
            function tableDone(elem, col, key) {
                elem.next().find('[lay-event="LAYTABLE_COLS"]').click(function (e) {
                    setTimeout(function () {
                        layui.$(e.currentTarget).find('.layui-form-checkbox').click(function () {
                            var local_config = {};
                            for (var i = 0; i <= col.length - 1; i++) {
                                if (typeof col[i].field !== 'undefined') {
                                    local_config[col[i].field] = col[i].hide;
                                }
                            }
                            var saveColsConfig = {
                                key: 'local_config',
                                value: local_config
                            };

                            // console.log("saveColsConfig",saveColsConfig)
                            layui.data(key, saveColsConfig);
                        })
                    }, 50);
                })
            }

            //表格 头部数据函数封装
            function getTableCols() {
                var col = [[
                    // {type: 'checkbox'},
                    {field: 'ID', title: 'ID', sort: true, align: "center", width: 70},
                    {field: 'BankName', title: '所属银行', sort: true, align: "center", width: 180},
                    {field: 'BankNum', title: '银行卡号', sort: true, align: "center", width: 180},
                    {field: 'Upi', title: 'Upi', sort: true, align: "center", width: 180},
                    {field: 'MerChantNum', title: '商家号', sort: true, align: "center"},
                    {field: 'MerchantOrderNum', title: '商家订单号', sort: true, align: "center", width: 180},
                    {field: 'Amount', title: '订单金额', sort: true, align: "center", width: 120},
                    {field: 'ActualAmount', title: '实际充值金额', sort: true, align: "center", width: 130},
                    {field: 'Commission', title: '手续费', sort: true, align: "center"},
                    {field: 'CallbackReturn', title: '回调返回信息', sort: true, align: "center", width: 180},
                    {field: 'NoticeUrl', title: '回调地址', sort: true, align: "center", width: 180},
                    {field: 'Currency', title: '币种', sort: true, align: "center"},
                    {field: 'OwnOrder', title: '我方平台订单', sort: true, align: "center", width: 180},
                    // {field: 'ProofOfPayment', title: '支付凭证', sort: true, align: "center", width: 180},
                    {
                        title: '支付凭证', templet: function (d) {
                            if (d.ProofOfPaymentImageUrl) {
                                let currImgStr = d.ProofOfPaymentImageUrl
                                currImgStr =  currImgStr.replaceAll('./','')
                                // var imageName = global_requestAddress + "/" + d.ProofOfPaymentImageUrl;
                                let imageName = global_requestAddress+"/"+currImgStr;
                                return '<div onclick="showImg(this)" ><img src="'+imageName+'" ' + 'alt="" width="60px" height="60px"></a></div>';
                            }else{
                                return ''
                            }
                        }, align: 'center', width: 100, unresize: true
                    },
                    // {field: 'BankName', title: '银行名', width:130,sort: true,align:"center", templet: function (d) {
                    //         var vipHtml = '<div><div class="ew-select-fixed"><select lay-filter="templetBankSel">';
                    //         layui.each(bankListArr, function (i, item) {
                    //             if (d.BankInformationId === item.ID) {  // 这里加selected
                    //                 vipHtml += ('<option  selected value="' + item.ID+ '">' + item.BankName + '</option>');
                    //             } else {
                    //                 vipHtml += ('<option  value="' + item.ID+ '">' + item.BankName + '</option>');
                    //             }
                    //         });
                    //         vipHtml += '</select></div></div>';
                    //         return vipHtml;
                    //     }},
                    {
                        field: 'Species',
                        title: '订单分类',
                        sort: true,
                        align: "center",
                        width: 120,
                        templet: function (d) {
                            if (d.Species == "1") {//三方单子
                                return '<button class="layui-btn  layui-btn-sm" style="background-color: #dea6a6;border-color: #dea6a6;">' + '三方单子' + '</button>'
                            } else if (d.Species == "2") {// 对冲
                                return '<button class="layui-btn  layui-btn-sm" style="background-color: #70a0d7;border-color: #70a0d7;">' + '对冲' + '</button>'
                            } else if (d.Species == "3") {//跑单
                                return '<button class="layui-btn  layui-btn-sm" style="background-color: #f30e0e;border-color: #f30e0e;">' + '跑单' + '</button>'
                            } else {
                                return ''
                            }
                        }
                    },
                    {
                        field: 'Callback',
                        title: '回调状态',
                        sort: true,
                        align: "center",
                        width: 120,
                        templet: function (d) {
                            if (d.Callback == "1") {//1没有回调
                                return '<button class="layui-btn  layui-btn-sm" style="background-color: #faa64b;border-color: #faa64b;">' + '没有回调' + '</button>'
                            } else if (d.Callback == "2") {// 2回调成功
                                return '<button class="layui-btn  layui-btn-sm" style="background-color: #33cabb;border-color: #33cabb;">' + '回调成功' + '</button>'
                            } else if (d.Callback == "3") {//3回调失败
                                return '<button class="layui-btn  layui-btn-sm" style="background-color: #465161;border-color: #465161;">' + '回调失败' + '</button>'
                            } else {
                                return ''
                            }
                        }
                    },
                    {
                        field: 'Status', title: '状态', sort: true, align: "center", templet: function (d) {
                            if (d.Status == "1") {//1等待支付
                                return '<button class="layui-btn  layui-btn-sm" style="background-color: #337ab7;border-color: #337ab7;">' + '等待支付' + '</button>'
                            } else if (d.Status == "2") {//2支付成功
                                return '<button class="layui-btn  layui-btn-sm" style="background-color: #28a745;border-color: #28a745;">' + '支付成功' + '</button>'
                            } else if (d.Status == "3") {// 3失败
                                return '<button class="layui-btn  layui-btn-sm" style="background-color: #993055;border-color: #993055;">' + '失败' + '</button>'
                            }else if (d.Status == "4") {//已过期
                                return '<button class="layui-btn  layui-btn-sm" style="background-color: #465161;border-color: #465161;">' + '已过期' + '</button>'
                            }else if (d.Status == "5") {//已确认
                                return '<button class="layui-btn  layui-btn-sm" style="background-color: #85e0f5;border-color: #85e0f5;">' + '已确认' + '</button>'
                            }else if (d.Status == "7") {//冲正
                                return '<button class="layui-btn  layui-btn-sm" style="background-color: #5466de;border-color: #5466de;">' + '冲正' + '</button>'
                            }else {
                                return ''
                            }

                        }
                    },
                    {
                        field: 'Created',
                        title: '创建时间',
                        align: "center",
                        width: 175,
                        sort: true,
                        templet: function (d) {
                            // return util.toDateString(d.Created* 1000);
                            return moment(d.Created * 1000).utc().utcOffset(currTimeZoneValue).format('YYYY-MM-DD HH:mm:ss');
                        }
                    },
                    {
                        field: 'Updated', title: '更新时间', align: "center", width: 175, templet: function (d) {
                            // return util.toDateString(d.Updated* 1000);
                            return moment(d.Updated * 1000).utc().utcOffset(currTimeZoneValue).format('YYYY-MM-DD HH:mm:ss');
                        }, sort: true
                    },
                    {title: '操作', width: 280, templet: '#orderListBar', fixed: "right", align: "center"}
                ]]
                return col;
            }

            //layuitable reload或第一次加载的时候，根据存储的local_config 确定哪些列是否选中
            function tableSetCol(col, key) {
                let colArr = col[0]
                var config_custom = layui.data(key);
                var local_config = config_custom['local_config'] || {};
                if (JSON.stringify(local_config) != '{}') {
                    for (var i = 0; i <= colArr.length - 1; i++) {
                        if (typeof colArr[i].field !== "undefined") {
                            colArr[i].hide = local_config[colArr[i].field];
                        }
                    }
                }
                return [colArr];
            }


            //添加银行
            $("#addGropeTask").click(function () {

                var index = layui.layer.open({
                    area: ['500px', '500px'],
                    fixed: false, //不固定
                    maxmin: false,
                    title: "添加银行卡",
                    skin: 'layui-layer-rim',//加上边框
                    type: 2,
                    content: "bank_card_add.html",
                    success: function (layero, index) {
                        var body = layui.layer.getChildFrame('body', index);

                    },
                    end: function () {//弹窗关闭后的回调函数
                        //利用laypage实现局部刷新,以下两种方式都可以
                        // $(".layui-laypage-btn").click()
                        //直接刷新当前修改的行
                        $(".layui-laypage-btn")[0].click()

                    }
                })
                // window.sessionStorage.setItem("index",index);
                // //改变窗口大小时，重置弹窗的宽高，防止超出可视区域（如F12调出debug的操作）
                // $(window).on("resize",function(){
                //     layui.layer.full(window.sessionStorage.getItem("index"));
                // })


                return false
            })

            /* 表格搜索 */
            var currTempObj;
            var bet_tb_this;
            form.on('submit(userTbSearch)', function (data) {


                // console.log("dataa",dataa)
                // console.log("currTempObj",data.field.username)
                // insTb.reload({where: data.field, page: {curr: 1}});
                currTempObj = {}
                currTempObj.kinds = 1
                // currTempObj.token = $.cookie('tokenMyb');

                //分类
                if (data.field.species){
                    currTempObj.species = data.field.species
                }
                localStorage.setItem('pay_order_where_species',data.field.species)

                //商户号
                if (data.field.merchant_num) {
                    currTempObj.merchant_num = data.field.merchant_num
                }
                localStorage.setItem('pay_order_where_merchant_num',data.field.merchant_num)

                //商户订单号
                if (data.field.merchant_order_num) {
                    currTempObj.merchant_order_num = data.field.merchant_order_num
                }
                localStorage.setItem('pay_order_where_merchant_order_num',data.field.merchant_order_num)

                //平台订单号
                if (data.field.own_order) {
                    currTempObj.own_order = data.field.own_order
                }
                localStorage.setItem('pay_order_where_own_order',data.field.own_order)

                //支付凭证
                if (data.field.proof_of_payment) {
                    currTempObj.proof_of_payment = data.field.proof_of_payment
                }
                localStorage.setItem('pay_order_where_proof_of_payment',data.field.proof_of_payment)

                //Upi
                if (data.field.upi){
                    currTempObj.upi = data.field.upi
                }
                localStorage.setItem('pay_order_where_upi',data.field.upi)

                //状态
                if (data.field.status === "999") {


                }  else if (data.field.status !== "999" && data.field.status) {
                    currTempObj.status = data.field.status
                }
                localStorage.setItem('pay_order_where_status',data.field.status)

                // 上传支付凭证1是，2否
                if(data.field.proof_of_payment_image_url == 1){
                    currTempObj.proof_of_payment_image_url = data.field.proof_of_payment_image_url
                }

                //回调状态
                if (data.field.callback === "777") {

                } else if (data.field.callback !== "777" && data.field.callback) {
                    currTempObj.callback = data.field.callback
                }
                localStorage.setItem('pay_order_where_callback',data.field.callback)

                var todayStartTime = new Date(new Date().toLocaleDateString()).getTime() / 1000 + 1
                var todayEndTime = new Date(new Date().toLocaleDateString()).getTime() / 1000 + 24 * 60 * 60 - 1

                if (data.field.startDate == '' && data.field.endDate == '') {

                    // currTempObj.start = todayStartTime
                    // currTempObj.end = todayEndTime

                } else if (data.field.startDate != '' && data.field.endDate != '') {

                    var date_str_start = new Date(data.field.startDate)
                    currTempObj.start = Date.parse(date_str_start) / 1000

                    var date_str_end = new Date(data.field.endDate)
                    currTempObj.end = Date.parse(date_str_end) / 1000

                } else {

                    if (data.field.startDate == "" && data.field.endDate != "") {

                        currTempObj.start = 0
                        var date_str_end = new Date(data.field.endDate)
                        currTempObj.end = Date.parse(date_str_end) / 1000

                    } else if (data.field.startDate != "" && data.field.endDate == "") {

                        var date_str_start = new Date(data.field.startDate)
                        currTempObj.start = Date.parse(date_str_start) / 1000
                        currTempObj.end = todayEndTime
                    }


                }
                localStorage.setItem('pay_order_where_startDate',data.field.startDate)
                localStorage.setItem('pay_order_where_endDate',data.field.endDate)


                //2.6.0之前清除保留之前的数据的最有用的方式
                if (bet_tb_this != null) {
                    // console.log("book_tb_this--不为null",bet_tb_this)
                    bet_tb_this.where = {};  //置空where
                }
                insTb.reload({
                    where: currTempObj,
                    page: {curr: 1},
                    done: function () {
                        bet_tb_this = this;
                        // console.log("book_tb_this----重载后的值",bet_tb_this)
                    }
                }, false);


                return false;
            });


            //监听单元格编辑
            table.on('edit(userTable)', function (obj) {
                var value = obj.value //得到修改后的值
                    , data = obj.data //得到所在行所有键值
                    , field = obj.field; //得到字段
                var param = {};
                param['id'] = data.ID;
                param['bank_information_id'] = data.BankInformationId;
                if (field === "CardNum") {
                    param['card_number'] = util.escape(value);
                }
                if (field === "Name") {
                    param['name'] = util.escape(value);
                }
                if (field === "Remark") {
                    param['remark'] = util.escape(value);
                }
                if (field === "IFSC") {
                    param['IFSC'] = util.escape(value);
                }
                // layer.msg('[ID: '+ data.id +'] ' + field + ' 字段更改值为：'+ util.escape(value));
                $.ajax({
                    url: global_requestAddress + global_requestAddress_js_bank + "?action=update",
                    data: param,
                    headers: {
                        token: mybck
                    },
                    type: "POST",
                    dataType: "json",
                    success: function (addResult) {
                        if (addResult.code === 200) {
                            notice.msg(addResult.msg, {icon: 1});
                        } else {
                            // layer.msg(addResult.msg);
                            notice.msg(addResult.msg, {icon: 2});
                        }
                    },
                });
            });

            //下拉框选择事件
            form.on("select(templetBankSel)", function (data) {
                //获取当前行tr对象
                var elem = data.othis.parents('tr');
                //第一列的值是Guid，取guid来判断
                var Guid = elem.first().find('td').eq(0).text();
                //选择的select对象值；
                var selectValue = data.value;
                // console.log("data",Guid)

                var param = {};
                param['id'] = Guid;
                param['bank_information_id'] = selectValue;

                $.ajax({
                    url: global_requestAddress + global_requestAddress_js_bank + "?action=update",
                    data: param,
                    headers: {
                        token: mybck
                    },
                    type: "POST",
                    dataType: "json",
                    success: function (addResult) {

                        if (addResult.code === 200) {
                            notice.msg(addResult.msg, {icon: 1});

                        } else {
                            // layer.msg(addResult.msg);
                            notice.msg(addResult.msg, {icon: 2});
                        }


                    },


                });

            })


            //监听开启开关按钮操作
            form.on('switch(table_status)', function (obj) {

                // console.log("obj",obj)

                // 获取当前控件
                var selectIfKey = obj.othis;
                // 获取当前所在行
                var parentTr = selectIfKey.parents("tr");
                // 获取当前所在行的索引
                // var parentTrIndex = parentTr.attr("data-index");

                //通过相对位置找对应行数据
                // 获取当前行第一和三列的值
                var currentwx_id = parentTr.find(('td:eq(0)')).text().trim();


                var currStatusBool = obj.elem.checked;
                // console.log("currStatusBool",currStatusBool)
                var messageTitle = '';
                var currStatusNum = 0;
                if (currStatusBool) {  //currStatusBool true
                    messageTitle = '系统将对该数据进行开启操作,确定对当前用户进行开启操作吗?'
                } else { //false

                    messageTitle = '系统将对该数据进行关闭操作,确定对当前用户进行关闭操作吗?'

                }

                //弹窗组件
                layer.open({
                    // type: 2,
                    area: ['450px', '195px'],
                    fix: false,
                    //不固定
                    maxmin: true,
                    shade: 0.3,
                    skin: 'layui-layer-rim',//加上边框
                    title: "温馨提示",
                    content: messageTitle,
                    // content: `<div>`+messageTitle+`</div>`,
                    btn: ['确定', '取消'],
                    // // 弹层外区域关闭
                    shadeClose: true,
                    btn1: function (index, layero) {//确定事件
                        //点击第一个按钮处理逻辑
                        // layer.msg("1");
                        if (currStatusBool) {
                            currStatusNum = 1
                        } else {
                            currStatusNum = 2
                        }

                        //进行ajax请求
                        var param = {};
                        param.status = currStatusNum
                        param.id = currentwx_id

                        $.ajax({
                            url: global_requestAddress + aaaaaaaaaaaaa + "?action=update",
                            method: 'POST',
                            data: param,
                            dataType: "json",
                            headers: {
                                token: mybck,
                            },
                            success: function (res) {
                                if (res.code === 200) {  //
                                    notice.msg(res.msg, {icon: 1});
                                    //列表的刷新
                                    insTb.reload();
                                    //关闭第一个弹窗的组件ID
                                    layer.close(index);
                                } else {
                                    notice.msg(res.msg, {icon: 2});
                                    insTb.reload();
                                    layer.close(index);
                                }
                            }
                        })


                    },
                    btn2: function (index, layero) {//取消事件
                        //点击第二个按钮处理逻辑
                        // layer.msg("2");

                        notice.msg("取消操作", {icon: 5});
                        // $.message({
                        //     message: "取消操作",
                        //     type: 'info',
                        //     showClose: true
                        // });

                        var x = obj.elem.checked;

                        obj.elem.checked = !x;
                        form.render();
                        layer.close(index);
                    },
                    cancel: function (index, layero) {//取消事件
                        //点击第二个按钮处理逻辑
                        // layer.msg("2");
                        notice.msg("取消操作", {icon: 5});
                        var x = obj.elem.checked;
                        obj.elem.checked = !x;
                        form.render();
                        layer.close(index);
                    }
                })


            });

            /* 表格工具条点击事件 */
            table.on('tool(userTable)', function (obj) {



                var currDatas = obj.data;
                if (obj.event === 'callbacksuccess') { // 修改
                    // showEditModel(obj.data);

                    layer.confirm('确定要回调成功当前数据吗？', {
                        skin: 'layui-layer-admin',
                        shade: .1
                    }, function (i) {
                        layer.close(i);
                        var loadIndex = layer.load(2);

                        var param = {};
                        param['id'] = currDatas.ID;

                        $.ajax({
                            url: global_requestAddress + global_requestAddress_js_collectionOperation + "?action=callback",
                            data: param,
                            headers: {
                                token: mybck
                            },
                            type: "POST",
                            dataType: "json",
                            success: function (addResult) {
                                layer.close(loadIndex);
                                if (addResult.code === 200) {
                                    notice.msg(addResult.msg, {icon: 1});
                                    insTb.reload({page: {curr: 1}});
                                } else {
                                    notice.msg(addResult.msg, {icon: 2});
                                }

                            },


                        });

                    });


                } else if (obj.event === 'detailBtn') {

                    jsondata = JSON.stringify(currDatas)
                    var index = layui.layer.open({
                        area: ['1200px', '500px'],
                        fixed: false, //不固定
                        maxmin: false,
                        title: "订单详情",
                        skin: 'layui-layer-rim',//加上边框
                        type: 2,
                        content: "pay_order_detail.html",
                        success: function (layero, index) {
                            var body = layui.layer.getChildFrame('body', index);
                            if (currDatas) {

                            }
                        },
                        end: function () {//弹窗关闭后的回调函数
                            //利用laypage实现局部刷新,以下两种方式都可以
                            // $(".layui-laypage-btn").click()
                            //直接刷新当前修改的行
                            $(".layui-laypage-btn")[0].click()

                        }
                    })


                } else if (obj.event === 'confirpay') {

                    jsondata = JSON.stringify(currDatas)
                    var index = layui.layer.open({
                        area: ['500px', '350px'],
                        fixed: false, //不固定
                        maxmin: false,
                        title: "确认付款",
                        skin: 'layui-layer-rim',//加上边框
                        type: 2,
                        content: "confirm_pay.html",
                        success: function (layero, index) {
                            var body = layui.layer.getChildFrame('body', index);
                            if (currDatas) {

                            }
                        },
                        end: function () {//弹窗关闭后的回调函数
                            //利用laypage实现局部刷新,以下两种方式都可以
                            // $(".layui-laypage-btn").click()
                            //直接刷新当前修改的行
                            $(".layui-laypage-btn")[0].click()

                        }
                    })


                } else if (obj.event === 'redo') {

                    var messageTitle = '系统将对该数据进行冲正操作,确定对当前数据进行冲正吗?';
                    layer.open({
                        // type: 2,
                        area: ['450px', '195px'],
                        fix: false,
                        //不固定
                        maxmin: true,
                        shade: 0.3,
                        skin: 'layui-layer-rim',//加上边框
                        title: "温馨提示",
                        content:messageTitle,
                        // content: `<div>`+messageTitle+`</div>`,
                        btn: ['确定','取消'],
                        // // 弹层外区域关闭
                        shadeClose: true,
                        btn1: function(index, layero) {//确定事件
                            //点击第一个按钮处理逻辑
                            // layer.msg("1");
                            //进行ajax请求
                            var param={};
                            //这个就是当前那条数据的ID
                            param.id =currDatas.ID

                            $.ajax({
                                url:global_requestAddress+global_requestAddress_js_collectionOperation+"?action=striking",
                                method:'POST',
                                data:param,
                                dataType:"json",
                                headers:{
                                    token:mybck,
                                },
                                success:function (res) {
                                    if(res.code === 200){  //
                                        notice.msg(res.msg, {icon: 1});
                                        //列表的刷新
                                        insTb.reload();
                                        //关闭第一个弹窗的组件ID
                                        layer.close(index);
                                    }else{
                                        notice.msg(res.msg, {icon: 2});
                                        insTb.reload();
                                        layer.close(index);
                                    }
                                }
                            })
                        },
                        btn2: function(index, layero){//取消事件
                            //点击第二个按钮处理逻辑
                            // layer.msg("2");

                            notice.msg("取消操作", {icon: 5});
                            form.render();
                            layer.close(index);
                        },
                        cancel: function(index, layero){//取消事件
                            //点击第二个按钮处理逻辑
                            // layer.msg("2");
                            notice.msg("取消操作", {icon: 5});
                            form.render();
                            layer.close(index);
                        }
                    })


                }


            });


        });

    }

    /* 点击图片放大 */
    function showImg(imgData){
        var img = new Image();
        // img.src = imgData.attr("src");
        var ta = $(imgData).find("img");
        img.src = ta.attr("src");
        var height = img.height; // 原图片大小
        var width = img.width; //原图片大小

        var winHeight = $(window).height() - 80;  // 浏览器可视部分高度
        var winWidth = $(window).width() - 100;  // 浏览器可视部分宽度

        // 如果图片高度或者宽度大于限定的高度或者宽度则进行等比例尺寸压缩
        if (height > winHeight || width > winWidth) {
            // 1.原图片宽高比例 大于等于 图片框宽高比例
            if (winWidth/ winHeight <= width / height) {
                width = winWidth;   //以框的宽度为标准
                height = winWidth * (height / width);
            }

            // 2.原图片宽高比例 小于 图片框宽高比例
            if (winWidth/ winHeight > width / height) {
                width = winHeight  * (width / height);
                height = winHeight  ;   //以框的高度为标准
            }
        }

        var imgHtml = "<img src='" + img.src + "' width='" + width + "px' height='" + height + "px' />";
        //弹出层
        layer.open({
            type: 1,
            shade:0,//shade值设为0即关闭遮罩功能
            skin: 'layui-layer-rim', //加上边框
            // offset: 'auto',
            // area: [500 + 'px',550+'px'],
            area: [width + 'px',(height + 50) + 'px'],  //原图显示,高度+50是为了去除掉滚动条
            shadeClose:true,
            scrollbar: false,
            title: "支付凭证预览", //不显示标题
            content: imgHtml, //捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响
            cancel: function () {
                //layer.msg('捕获就是从页面已经存在的元素上，包裹layer的结构', { time: 5000, icon: 6 });
            }
        });
    }


</script>
</body>
</html>
